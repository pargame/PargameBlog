# 그래프 뷰에 관한 내 요구사항을 간단하게 정리함.

# 기본 물리 시뮬 설정
- 각 노드: 일정 속도 이하면 해당 노드의 물리 시뮬 비활성화(그 자리 고정)
- 전체 노드: 고정된 노드의 일정 비 이상이면, 모든 노드의 물리 시뮬 비활성화(모든 노드 고정)

## 이벤트 기준 정리
- 처음 그래프 뷰 열었을 시: 그래프가 화면 중앙에 위치하도록 하고, 전체 물리 시뮬은 켜짐->이후 감소 후 정적

- 빈 영역 드래그: 
    1. 화면 패닝 이동하여 자유롭게 이동 가능
    2. 빈 영역 클릭과 구분을 위해 실제 마우스 틱 이동이 있을 때 발동
    3. 물리 시뮬은 상관 없음. (모두 정적 상태)
    4. 열려 있는 인사이트 드로어에도 영향없음
- 전체 그래프가 정적인 상태 && 단일 노드 마우스 호버 시: 
    1. 해당 노드와 연결된 링크, 그리고 그 링크와 연결된 노드만 남기고 나머지 노드&&링크는 언더라이팅효과
    2. 물리 시뮬은 상관 없음. (모두 정적 상태)
- 아무 때나 호버에서 벗어날 시: 
    1. 호버 언더라이팅 효과 끔
    2. 물리 시뮬은 상관 없음. (모두 정적 상태)
- 노드 클릭 || 인사이트 드로어 내 위키링크 클릭: 
    1. 해당 노드(위키링크)에 해당하는 문서가 오른쪽 인사이트드로어로 오른쪽 절반만큼 열림(혹은 전환)
    2. 열린 드로어 때문에 그래프뷰는 절반으로 줄어듬.
        2-1. 그에 따라 해당 노드(위키링크)가 나머지 왼쪽 절반 화면 중 가운데로 와야 함
    3. 물리 시뮬은 상관 없음. (모두 정적 상태)
    4. 클릭된 노드의 테두리가 생기는 효과

# 그래프 뷰에 관한 내 요구사항을 간단하게 정리함.

# 기본 물리 시뮬 설정
- 각 노드: 일정 속도 이하면 해당 노드의 물리 시뮬 비활성화(그 자리 고정)
- 전체 노드: 고정된 노드의 일정 비 이상이면, 모든 노드의 물리 시뮬 비활성화(모든 노드 고정)

## 이벤트 기준 정리
- 처음 그래프 뷰 열었을 시: 그래프가 화면 중앙에 위치하도록 하고, 전체 물리 시뮬은 켜짐->이후 감소 후 정적

- 빈 영역 드래그: 
    1. 화면 패닝 이동하여 자유롭게 이동 가능
    2. 빈 영역 클릭과 구분을 위해 실제 마우스 틱 이동이 있을 때 발동
    3. 물리 시뮬은 상관 없음. (모두 정적 상태)
    4. 열려 있는 인사이트 드로어에도 영향없음
- 전체 그래프가 정적인 상태 && 단일 노드 마우스 호버 시: 
    1. 해당 노드와 연결된 링크, 그리고 그 링크와 연결된 노드만 남기고 나머지 노드&&링크는 언더라이팅효과
    2. 물리 시뮬은 상관 없음. (모두 정적 상태)
- 아무 때나 호버에서 벗어날 시: 
    1. 호버 언더라이팅 효과 끔
    2. 물리 시뮬은 상관 없음. (모두 정적 상태)
- 노드 클릭 || 인사이트 드로어 내 위키링크 클릭: 
    1. 해당 노드(위키링크)에 해당하는 문서가 오른쪽 인사이트드로어로 오른쪽 절반만큼 열림(혹은 전환)
    2. 열린 드로어 때문에 그래프뷰는 절반으로 줄어듬.
        2-1. 그에 따라 해당 노드(위키링크)가 나머지 왼쪽 절반 화면 중 가운데로 와야 함
    3. 물리 시뮬은 상관 없음. (모두 정적 상태)
    4. 클릭된 노드의 테두리가 생기는 효과
- 빈영역 클릭:
    1. 열려있는 인사이트 드로어 닫음->그래프뷰 크기도 원상복구
    2. 테두리 강조된 노드도 효과 끔

## 의사코드 예

OnInitView() //맨 처음 뷰 열 때 호출
    StartSimul()

OnDragingEmptyView(Mouse Dx, Mouse Dy)
    if(Dx||Dy) // 실제 드래그일 때
        MoveView(Dx,Dy) //드래그한만큼 화면 이동

OnDragingNode(Mouse Dx, Mouse Dy) //노드 드래그 이벤트
    if(Dx||Dy)  //실제 드래그일 때
        StartSimul() //물리를 전체 키고
        MoveNode(Dx,Dy) //해당 노드를 드래깅해서 이동

OnClickingNode(target) //노드 클릭시 
    InsightDrawerChange(target) //이 함수 호출



OnClickingEmptyView()
    if(isInsightDrawerOpen)  //드로어가 열려있을 때는 닫고, 뷰 크기를 복구
        InsightDrawerClose()
        GraphViewResize(fullscreen)
        NodeBoundaryOff()  //포커싱 노드의 테두리 효과를 끔

InsightDrawerChange(target)
    if(target==nowOpened)  //이미 클릭되어 포커싱 되어있는 노드라면 아무작업 안함
        return

    if(isInsightDrawerOpen)     //이미 열려있다면 그 내용만 전환
        ChangeContent(target)
    else
        InsightDrawerOpen(target) //실제 열면서
        GraphViewResize(half-left) //그래프 뷰는 왼쪽 화면 절반으로 리사이즈
    NodeBoundaryOff() // 기존 포커싱 노드의 테두리는 끔
    NodeBoundaryOn(target)  //새 포커싱 노드의 테두리 킴

OnNodeHover(target) //노드 호버 시작시
    if(!isAllStop)  //전체 노드가 정적이면 그냥 리턴
        return
    
    RelatedNodesAndLinks=getRelatedNodesAndLinks(target) // 인접한 링크 및 노드의 정보 저장
    UnderLightingExcept(RelatedNodesAndLinks) //연관된 노드 링크를 제외하고 언더라이팅 효과

OffNodeHover()  //노드 호버 끝시
    UnderLightOffAll()  //언더라이팅 된 효과 복구


    
    
    
 ```

## 구현 매핑(현황) 및 미반영 항목
아래는 현재 리포지토리의 구현과 위 요구사항을 비교한 요약입니다. 구현은 대부분 요구사항을 반영하고 있으나, 문서화 또는 스타일 보완이 필요한 항목이 있습니다.

- 이미 구현된 항목
  - 노드의 일정 속도 이하에서 자동으로 물리 시뮬을 비활성화(노드 고정).
  - 전체 노드 중 고정된 노드 비율이 일정 수준 이상이면 시뮬 전체 정지.
  - 초기 열기 시 시뮬레이션 가동 후 서서히 안정화(alphaTarget 등 사용).
  - 빈 영역 클릭/패닝(배경 rect + d3.zoom)과 노드 드래그(d3.drag) 처리.
  - 전체 정적 상태에서 노드 호버 시 인접 노드/링크만 활성화하고 나머지는 언더라이팅(faded) 처리.
  - 노드 클릭 시 외부 핸들러로 선택 정보 전달(인사이트 드로어 연동 가능).

- 문서화/보완 권장(현재 코드상 partial/미적용)
  1. 클릭된 노드의 테두리(시각 강조)
     - 구현상 `selected` 클래스는 노드에 할당되지만 프로젝트 CSS(`src/components/graph/GraphView.css`)에 `.selected` 규칙이 정의되어 있지 않습니다.
     - 권장: CSS에 `.graph-wrap svg circle.node.selected { stroke: <color>; stroke-width: <px>; filter: drop-shadow(...); }` 스타일을 추가하여 클릭 포커스 효과를 시각적으로 명확히 하세요.
  2. 빈 영역 드래그와 빈 클릭의 분리 기준 명시
     - 구현은 d3의 drag/zoom 이벤트와 포인터 이동을 이용해 드래그를 판정합니다(코드에서 '실제 이동'을 >0 이동으로 판단). 요구사항 문서에는 '실제 마우스 틱 이동'이라는 문구가 있으므로 문서에 구체적 분류(예: dragPixelThreshold, dragDebounce 등)를 추가하면 QA가 쉬워집니다.
  3. 모바일/터치 정책 명시 필요
     - 현재는 포인터/마우스 기반 처리이며, 터치 특수 케이스(탭 vs 터치드래그 등)에 대한 정책이 문서에 없습니다. 필요하면 터치 제스처 우선순위를 정리하세요.

## (참고) 구현에서 사용된 임계값(코드에서 확인된 값 — 문서용 참고, 코드 자체는 변경하지 않았음)
- 노드 속도 임계값: NODE_SPEED_THRESHOLD = 0.5
- 전체 idle 비율(정지 판정): NODE_IDLE_RATIO = 0.9
- idle tick 수(자동 고정 전): IDLE_TICKS_TO_STOP = 5
- 드래그로 인한 시뮬 킥: 코드에서는 '이동 거리 > 0'이면 킥을 트리거함(필요 시 명확한 픽셀 임계값 권장)
- 시뮬 킥 파라미터(예시): kick alpha target = 0.3, relaxTo = 0.05, relaxAfter = 1200(ms)

위 보완사항 중(특히 CSS의 `.selected` 규칙 추가와 문서의 드래그 판정 기준 명시)은 안전한 업데이트로 구현-요구사항 간 불일치를 줄여 줍니다. 원하시면 이 문서 반영(완료)과 함께 실제 CSS 추가도 제가 바로 적용해 드리겠습니다.



